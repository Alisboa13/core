<!-- Head page section================================================== -->
<div *ngIf="indicator$ | async as indicator else loading;">
  <!--
  <div *ngIf="indicator.registriesType !== 2">
      {{ this.showGraph(indicator) }}
  </div>
  <div *ngIf="indicator.registriesType == 2">
      {{ this.showDispersionGraph(indicator) }}
  </div>
-->
  <section>
    <div id="head-page-section" class="l-grey-bg head-page-section">
      <div class="container">
        <app-navigation-buttons></app-navigation-buttons>
        <div class="row">
          <div class="col-sm-8">
            <div class="head-title">
              <h5>{{selectedYearText}}</h5>
              <h4 *ngIf="indicatorGroupName$ | async as indicatorGroupName">{{ indicatorGroupName }}</h4>
              <h1>
                {{ indicator.name }}
              </h1>
            </div>
            <!-- end subsection-text -->
          </div>
          <!-- end col-sm-8 -->
          <div class="col-sm-4">
            <div class="head-title">
              <div class="col-sm-6">
                <div class="inline" style="text-align: center;">Valor Indicador</div>
                <div class="row-number row-h1 inline" *ngIf="value$ | async as value else zero;">
                  <div *ngIf="indicator.registriesType == RegistryType.PercentRegistry">
                    {{ value }}%
                  </div>
                  <div *ngIf="indicator.registriesType != RegistryType.PercentRegistry">
                    {{ value }}
                  </div>
                </div>
              </div>
              <div class="col-sm-6">
                <div class="inline" style="text-align: center;">Valor Meta</div>
                <div class="row-number row-h1" *ngIf="goal$ | async as goal else na;">
                  {{ goal }}
                </div>
              </div>
            </div>
            <!-- end subsection-text -->
          </div>
          <!-- end col-sm-4 -->
        </div>
        <!-- end row -->
      </div>
      <!-- end container -->
    </div>
</section>

<!-- end head-page-section -->
  <section>
    <div>
      <ol class="breadcrumb shortcode">
        <div *ngIf="indicator.registriesType != RegistryType.ExternalRegistry">
          <button class="btn btn-xs btn-clean-2" (click)="openModal(editGoalModal)">Modificar Metas</button>
          <button class="btn btn-xs btn-clean-2">Modificar Indicador</button>
        </div>
        
        <div *ngIf="indicator.registriesType == RegistryType.ExternalRegistry">
            <button class="btn btn-xs btn-clean-2" (click)="openModal(editGoalModal)">Modificar Metas</button>
        </div>        
      </ol>
    </div>
  </section>
  <!-- about boxes
  ================================================== -->
  <section style="margin-top: -70px;">
    <div class="page-section pad-sec">
      <div class="container">
        <!--subtitle row ===================================== -->
        <div class="row">
          <div class="col-md-12 pad-bt-60">
            <div class="heading-block">
              <table border="0">
                <tr>
                  <td width="40%">Seleccione año a mostrar</td>
                  <td width="30%">Seleccione mes a mostrar</td>
                  <td style="padding-left: 200px;"><span>Mostrar Gráfico</span></td>
                </tr>
                <tr>
                  <td width="40%">
                    <!-- Filtros año-mes -->
                    <!--<button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#modal-login">
                      Filtrar por Fecha
                    </button> -->
                    <!--Dropdown Year Filter-->
                    <!--<div class="col-md-6">-->
                    <div class="btn-group" dropdown>
                      <button id="button-basic" dropdownToggle type="button" class="btn btn-primary dropdown-toggle" aria-controls="dropdown-basic">
                        {{ selectedYearText }} <span class="caret"></span>
                      </button>
                      <ul id="dropdown-basic" *dropdownMenu class="dropdown-menu"
                          role="menu" aria-labelledby="button-basic">
                        <li><a class="dropdown-item" (click)="selectRegistries(allYears, '')">Todos los años</a></li>
                        <li *ngFor="let year of years"><a class="dropdown-item" (click)="selectRegistries(year, '')">Año {{ year }}</a></li>
                      </ul>
                    </div>
                    <!--</div>-->
                  </td>
                  <td width="30%">

                    <!--Dropdown Month Filter-->
                    <!--<div class="col-md-6">-->
                    <div class="btn-group" dropdown [isDisabled]="isMonthDisabled">
                      <button id="button-basic" dropdownToggle type="button" class="btn btn-primary dropdown-toggle" aria-controls="dropdown-basic">
                        {{ selectedMonthText }} <span class="caret"></span>
                      </button>
                      <ul id="dropdown-basic" *dropdownMenu class="dropdown-menu"
                          role="menu" aria-labelledby="button-basic">
                        <li><a class="dropdown-item" (click)="selectRegistries('', allMonths)">Todos los meses</a></li>
                        <li *ngFor="let month of monthsOfTheYear"><a class="dropdown-item" (click)="selectRegistries('', month)">{{ month }}</a></li>
                      </ul>
                    </div>
                    <!--</div>-->

                  </td>

                  <!-- Graph Type Dropdown (no PercentRegistry) -->
                  <td *ngIf="indicator.registriesType != RegistryType.PercentRegistry" style="padding-left: 200px;">
                    <!--<app-indicator-graph-option></app-indicator-graph-option>-->
                    <!--<app-indicator-graph-option [graph]="data[0]"></app-indicator-graph-option> --> <!--from design-->
                      <div class="btn-group" dropdown>
                        <button id="button-basic" dropdownToggle type="button" class="btn btn-primary dropdown-toggle" aria-controls="dropdown-basic">
                          {{ selectedTypeChart }} <span class="caret"></span>
                        </button>
                        <ul id="dropdown-basic" *dropdownMenu class="dropdown-menu"
                            role="menu" aria-labelledby="button-basic">
                          <li *ngFor="let typeChart of typesChart"><a class="dropdown-item" (click)="selectChart(typeChart, indicator)">{{ typeChart }}</a></li>
                        </ul>
                      </div>
                      <!--</div>-->
                  </td>

                  <!-- Graph Type Dropdown (PercentRegistry) -->
                  <td *ngIf="indicator.registriesType == RegistryType.PercentRegistry" style="padding-left: 200px;">
                    <!--<app-indicator-graph-option></app-indicator-graph-option>-->
                    <!--<app-indicator-graph-option [graph]="data[0]"></app-indicator-graph-option> --> <!--from design-->
                      <div class="btn-group" dropdown>
                        <button id="button-basic" dropdownToggle type="button" class="btn btn-primary dropdown-toggle" aria-controls="dropdown-basic">
                          Gráfico de dispersión <span class="caret"></span>
                        </button>
                        <ul id="dropdown-basic" *dropdownMenu class="dropdown-menu"
                            role="menu" aria-labelledby="button-basic">
                          <li *ngFor="let typeChart of typeDispersion"><a class="dropdown-item" (click)="selectChart(typeChart, indicator)">{{ typeChart }}</a></li>
                        </ul>
                      </div>
                      <!--</div>-->
                  </td>
                </tr>
              </table>
            </div>
          </div>
          <!-- end col-md-12 -->
        </div>
        <!-- end row -->
        <!--graph row ======================================== -->
        <!-- end row -->
        <!--details files row ======================================== -->
        <!--
        <div class="row">
          <div class="col-md-12">
            <div style="align-content: center; height: 50vh;" *ngIf="indicator.registriesType == RegistryType.PercentRegistry">
              <canvas baseChart 
                [datasets]="DispersionChartData"
                [labels]="lineChartLabels"
                [options]="dispersionChartOptions"
                [colors]="dispersionChartColors"
                [legend]="lineChartLegend"
                [chartType]="lineChartType">
              </canvas>
            </div>
            <div style="align-content: center; height: 50vh;" *ngIf="indicator.registriesType != 2">
              <canvas baseChart
                [datasets]="lineChartData"
                [labels]="lineChartLabels"
                [options]="lineChartOptions"
                [colors]="lineChartColors"
                [legend]="lineChartLegend"
                [chartType]="lineChartType">
              </canvas>
            </div>
          </div>
        </div>
        <div class="container" *ngIf="indicator.registriesType == RegistryType.PercentRegistry">
          <div class="row">
            <div class="col-md-6">
              <h4>Desviación estándar: {{devStandar}}</h4>
              <h4>Varianza: {{varianza}}</h4>
            </div>
          </div>
        </div>
      -->
        <app-chart [indicator]="indicator" [selectedTypeChart]="selectedTypeChart"></app-chart>
        <div class="row">
          <div class="col-md-12 pad-bt-60">
            <div class="heading-block">
              <table border="0">
                <tr>
                  <td width="70%">
                    <h2>Descripción</h2>
                  </td>
                  <td style="padding-left: 200px;">
                    <!--<button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#modal-login">
                      Añadir registro
                    </button>-->
                    <div *ngIf="indicator.registriesType != RegistryType.ExternalRegistry">
                      <button type="button" class="btn btn-primary pull-right" style="margin-bottom: 20px" (click)="openModal(addRegistry)">Añadir registro <span class="glyphicon glyphicon-plus"> </span></button>
                    </div>
                  </td>
                </tr>
              </table>
            </div>
            <!--Begin tab-->
            <!--Tabset removed because I didn't know what to do with him-->
            <!--Registries list and RegistriesType (from indicator) are needed-->
            <app-indicator-detail-registry (updateEvent)="loadDataByFilters()" [registries]="indicator.registries" [registriesType]="indicator.registriesType"></app-indicator-detail-registry>
          </div>
        </div>
      </div>
    </div>
  </section>



  <!--MODALS-->

  <!-- Modal Add Registry -->
  <ng-template #addRegistry>
    <div class="modal-header">
      <h4 class="modal-title pull-left">Ingrese un Nuevo Registro</h4>
      <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <app-registry-form [indicator]="indicator" [idIndicator]="idIndicator" [modalRef]="modalRef"></app-registry-form>
    </div>
  </ng-template>

  <!-- Modal Edit Goal -->
  <ng-template #editGoalModal>
    <app-goals-editor [indicator]="indicator" (updateGoalEvent)="updateGoal($event)" [modalRef]="modalRef"></app-goals-editor>
  </ng-template>


  <!--UX-->

  <ng-template #zero>
    <div class="row-number row-h1 inline">
      <div *ngIf="indicator.registriesType == RegistryType.PercentRegistry">
        0%
      </div>
      <div *ngIf="indicator.registriesType != RegistryType.PercentRegistry">
        0
      </div>
    </div>
  </ng-template>

  <ng-template #na>
    <div class="row-number row-h1 inline">
      N/A
    </div>
  </ng-template>

</div>

<!------------------------------------------------------------------------------------------>
<!-- OLD DESIGN
<h1> OLD DESIGN </h1>

<div *ngIf="indicator$ | async as indicator; else loading">
  <div id="head-page-section" class="l-grey-bg head-page-section">
    <div class="container">
      <div class="row">
        <div class="col-md-8 col-sm-7">
          <div class="head-title">
            <h1>
              {{ indicator.name }}
            </h1>
          </div>
        </div>
      </div>
    </div>
  </div>
-->



<ng-template #loading>
  <div id="head-page-section" class="l-grey-bg head-page-section">
    <div class="container">
      <div class="row">
        <div class="col-md-8 col-sm-7">
          <div class="head-title">
            <h2>
              Cargando...
            </h2>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #noRegistries>
  <h2>Aún no se han cargado registros.</h2>
</ng-template>

